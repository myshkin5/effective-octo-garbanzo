[![Go Report Card](https://goreportcard.com/badge/myshkin5/effective-octo-garbanzo)](https://goreportcard.com/report/myshkin5/effective-octo-garbanzo)

# effective-octo-garbanzo

This is an opinionated* reference implementation of a Go microservice. It is not intended to be used as production code but it is written with the (opinionated*) standards of production code.

Whenever possible, idiomatic Go is used with as few dependencies (opinionated*) as possible. Go's idiom of using very short variable names is not followed much. I mostly agree with this idiom but when introducing a new language, I feel verbosity is best.

\* If you have a different opinion that you think would make this implementation better, file an issue or send me a pull request.

## What does it do?

`effective-octo-garbanzo` is a microservice that sits on its own Postgres relational database. The name was autogenerated by GitHub's new repository form. Per the name, the service serves _Octos_ and _Garbanzos_ in a parent/child relationship. _Octos_ have a `name` attribute which must be unique (the name is included in the resource URI). _Garbanzos_ have a `type` attribute (valid types are `DESI` and `KABULI`) and a `diameter-mm` attribute which must be a positive decimal number.

![](./docs/db.png)

The database schema is [migrated](https://github.com/mattes/migrate) on startup from a [self-contained schema](./persistence/ddl/001_initial.up.sql). Note that multiple migrations are supported but since this is reference implementation, only one migration will ever be included here.

## Running the tests

There are several dependencies that need to be installed prior to running the tests:

* `goimports` `go get golang.org/x/tools/cmd/goimports`
* `ginkgo` `go get github.com/onsi/ginkgo/ginkgo`
* `docker-compose` https://docs.docker.com/compose/install/
* Docker https://docs.docker.com/engine/installation/

There are several Go dependencies that are vendored as git submodules. Run the following after cloning the repository and after each pull:

```bash
git submodule update --init --recursive
```

Finally to actually run the tests:

```bash
./scripts/test
```
## Running the code

Either by running the tests or by running the following script, a docker image is created:

```bash
./scripts/build
```

## API Documentation

HATEOAS

### Standard Response Headers

`Content-Type: application/json`

### Standard Error Response

#### Example
```json
{
    "code": 400,
    "error": "Error creating new octo",
    "errors": [
        "name must be present",
        "name must match regular expression '^[\\w-]+$'"
    ],
    "status": "Bad Request"
}
```

### `GET /`

#### Response Statuses

`200 - OK`: Only `200 - OK` is returned.

#### Response Body

Field | Description
--- | ---
`health` | Link to the health endpoint.
`octos` | Link to the octos collection endpoint.

##### Example

```json
{
    "health": "http://localhost:8080/health",
    "octos":  "http://localhost:8080/octos"
}
```

### `GET /health`

#### Response Statuses

`200 - OK`: Only `200 - OK` is returned.

#### Response Body

Field | Description
--- | ---
`health` | The health of the service. Currently only `GOOD` is supported.

##### Example

```json
{
    "health": "GOOD"
}
```

### `GET /octos`

#### Response Statuses

`200 - OK`: Only `200 - OK` is returned.

#### Response Body

Returns a list of octos. See TODO for the definition of an octo.

##### Example

```json
[
    {
        "link": "http://localhost:8080/octos/kraken",
        "name": "kraken",
        "garbanzos": "http://localhost:8080/octos/kraken/garbanzos"
    }
]
```

### `POST /octos`

### Request Body

Field | Description
--- | ---
`name` | The name of the new octo to be created.

##### Example

```json
{
    "name": "kraken"
}
```

#### Response Statuses

`200 - OK`: Only `200 - OK` is returned.

### Response Body

Returns the newly created octo. See TODO for the definition of an octo.

##### Example

```json
{
    "link":      "http://localhost:8080/octos/kraken",
    "name":      "kraken",
    "garbanzos": "http://localhost:8080/octos/kraken/garbanzos"
}
```

### `GET /octos/:octoName`

#### Request Parameters

Field | Description
--- | ---
`octoName` | The name of the octo to be retrieved.

### Response Body

Field | Description
--- | ---
`link` | This resource.
`name` | The name of the octo.
`garbanzos` | Link to the garbanzos collection endpoint for this octo.

##### Example

```json
{
    "link":      "http://localhost:8080/octos/kraken",
    "name":      "kraken",
    "garbanzos": "http://localhost:8080/octos/kraken/garbanzos"
}
```
